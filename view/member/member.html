<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <link rel="stylesheet" href="../../css/style.css">
    <style type="text/css">
    .box {
      height: 12rem;
      position: relative;
      overflow: hidden;
      background: #FFF;
      transform: translate3d(0, 0, 0); }

     .box:after {
      content: '';
      display: block;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
			background: linear-gradient(to bottom right, #FF86AF, rgba(255, 134, 175, 0.8) 50%, #FF699C 50%);/* 
      background: linear-gradient(to bottom, #ee88aa, rgba(221, 238, 255, 0) 80%, rgba(255, 255, 255, 0.5)); */
      z-index: 5;
      transform: translate3d(0, 0, 0); }
	 .mui-icon .mui-badge{
			    height: 10px;
			    margin-left: -8px;
					color: #fff;
    		}
				.mui-icon .mui-badge h4{
					font-size: 18px;
				}
				.my_price{
					text-align: right;
				}
    	 
    </style>
  </head>

  <body class="body-padding-xs">
    <div class="user-header box">
      <a id="setting" data-view="_www/view/member/setting.html" class="user-setting bbc-icon bbc-icon-setting" style="right: 4rem;"></a>
      <a id="msg" data-view="_www/view/member/msg.html" class="user-setting mui-icon bbc-icon bbc-icon-message-gap action-clickview" ><i  class=" mui-badge msg-badge  mui-badge-danger mui-hidden "></i></a>
      <div id="user_info" class="user-logined " data-view="_www/view/member/userinfo/userinfo.html">
        <div class="login-avatar">
        		<!--<i class="bbc-icon bbc-icon-member fontB"></i>-->
        		<img class="userinfo-avatar" id="head-img" src="" onerror="javascript:this.src='../../img/daguan.png';"/>
        </div>
        <div  class="user-accout"><span  style="color: #646464;"></span></div>
				<h4 id="account"></h4>
        <div><span id="grade_name" class="fontS " ><sm class="agency"></sm>大观注册心理师</span></div>
      </div>
    </div>
    <section class="section-white">
      <!-- <div class="section-title user-title">
        <div class="title-txt"><i class="user-icon bbc-icon bbc-icon-assets user-assets"></i> 我的资产</div>
      </div>
      <div class="box-display content-vertical-padded user-assetses font-gray-20">
        <div data-needlog="true" data-view="_www/view/member/income/index.html" class="box-item-flex1 content-center action-clickview "><em class="assets-data" id="income">0</em><br><span class="font-gray-20 fontS">收入</span></div>
        <div data-needlog="true" data-view="_www/view/member/coupon/coupon.html" class="box-item-flex1 content-center "><em class="assets-data" id="coupon">0</em><br><span class="font-gray-20 fontS">优惠券</span></div>
        <div  class="box-item-flex1 content-center "><em class="assets-data" id="experience">0</em><br><span class="font-gray-20 fontS">卡包</span></div>
        <div data-needlog="true" data-view="_www/view/member/point/integral.html" class="box-item-flex1 content-center action-clickview"><em class="assets-data" id="integral">0</em><br><span class="font-gray-20 fontS">积分</span></div>
      </div> -->
    </section>
    <section class="section-white">
      <ul class="mui-table-view">
		<li data-needlog="true" data-view="_www/view/member/return/returns.html" class="mui-table-view-cell flex-box">
			<a class="mui-navigate flex-g4"><i class="user-icon bbc-icon bbc-icon-assets user-assets"></i> 我的资产</a>
			<p class="flex-g1 my_price">￥0.00</p>
		</li>
        <li data-needlog="true" data-view="_www/view/member/meset.html" class="mui-table-view-cell action-clickview">
          <a class="mui-navigate-right"><i class="user-icon bbc-icon bbc-icon-history user-returns"></i> 我的咨询设置</a>
        </li>
        <li data-needlog="true" data-view="_www/view/counsellor/myondate.html" class="mui-table-view-cell action-clickview">
          <a class="mui-navigate-right"><i class="user-icon bbc-icon bbc-icon-rate-empty user-rate"></i> 我的咨询</a>
        </li>
        <li data-needlog="true" data-view="_www/view/member/classes/index.html" class="mui-table-view-cell action-clickview">
          <a class="mui-navigate-right"><i class="user-icon bbc-icon bbc-icon-password user-safe"></i> 我的课程/活动</a>
        </li>
        <li data-needlog="true" data-view="_www/view/member/favorite/favorite.html" class="mui-table-view-cell mui-hidden">
          <a class="mui-navigate-right"><i class="user-icon bbc-icon bbc-icon-history-gap user-favorite"></i> 我的活动</a>
        </li>
      </ul>
    </section>
	
	<section class="section-white">
      <ul class="mui-table-view">
        <li data-needlog="true" data-view="_www/view/member/rate/rate.html" class="mui-table-view-cell action-clickview mui-hidden">
          <a class="mui-navigate-right"><i class="user-icon bbc-icon bbc-icon-rate-empty user-rate"></i> 我的账户</a>
        </li>
        <li data-needlog="true" data-view="_www/view/member/ondate/index.html" class="mui-table-view-cell action-clickview">
          <a class="mui-navigate-right"><i class="user-icon bbc-icon bbc-icon-communication user-complain"></i>预约时间 </a>
        </li>
        <li data-needlog="true" data-view="_www/view/member/article/index.html" class="mui-table-view-cell action-clickview">
          <a class="mui-navigate-right"><i class="user-icon bbc-icon bbc-icon-star-empty user-favorite"></i> 我的文章</a>
        </li>
      </ul>
    </section>
    
    <nav class="mui-bar bbc-bar-tab">
      <a class="bbc-tab-item " data-webview="_www/view/index.html">
        <span class="mui-icon bbc-icon bbc-icon-home"></span>
        <span class="mui-tab-label">首页</span>
      </a>
      <a class="bbc-tab-item" data-webview="_www/view/counsellor/index.html">
        <span class="mui-icon bbc-icon bbc-icon-package"><i class="mui-badge mui-badge-danger mui-hidden"  id="advice-count"></i></span>
        <span class="mui-tab-label">工作台</span>
      </a>
      <a class="bbc-tab-item" data-webview="_www/view/clac/index.html">
        <span class="mui-icon bbc-icon bbc-icon-moments"></span>
        <span class="mui-tab-label">课程/活动</span>
      </a>
      <a class="bbc-tab-item" data-webview="_www/view/msg/index.html">
        <span class="mui-icon bbc-icon bbc-icon-message"><span class="mui-badge mui-badge-danger mui-hidden" style="display: none;" id="msg-count"></span></span>
        <span class="mui-tab-label">消息</span>
      </a>
      <a class="bbc-tab-item bbc-active" >
        <span class="mui-icon bbc-icon bbc-icon-user-empty"></span>
        <span class="mui-tab-label">我的</span>
      </a>
    </nav>
    
    <script src="../../js/zepto.js"></script>
    <script src="../../js/mui.min.js"></script>
    <script src="../../js/template.min.js"></script>
    <script src="../../config.js"></script>
    <script src="../../js/app.js"></script>
    <script type="text/javascript" charset="utf-8">
      mui.plusReady(function() {
      	window.addEventListener('refresh', fetchMemberData);
//log(app.getState())
		fetchMemberData();
		 var ret = null;
		function fetchMemberData(){ 
			log(app.getState())
			if(app.getState()){
				document.getElementById("account").innerHTML = app.getState().nickname;
				$('.agency').text(app.getState().agency)
				//msg
		  		var state = app.getState();
			  	var param = {
		            'method': config.apimethod.ismsg,
		            'source':config.source,
		            'account':state.token
		       }
		        $.dataRequest(param, function(rs) {
		        		if (rs) {
		        			$('.msg-badge').removeClass('mui-hidden')
		        		}
		        })
	
		        var param = {
			          'method': config.apimethod.counsellorindex,
			          'account': state.token,
			          'source':config.source
			      } 
	
		        $.dataRequest(param, function(rs) { 
		        	// log('---------11-----')  
		        		log(rs)
		        		$('.my_price').text(Currency.format(rs.income))
//		        		$('#income').text(Currency.format(rs.income))
//		        		$('#integral').text(rs.points)
		        })

			     
			      var param = {
			          'method': config.apimethod.userinfo,
			          'account': state.account,
			          'source':config.source
			      }
			      $.dataRequest(param, function(rs) {
			        var data = rs;
			        ret = rs;
			        console.log('----abc----------')
			        log(rs)
			        if(ret.avar){
			            document.getElementById("head-img").src = config.imgser+'/'+ret.avar;
			        }else{
			            document.getElementById("head-img").src = '../../shop_logo.gif';
			        }

			      });
			}else{
				$('#income').text(0)
		        	$('#integral').text(0)
		        	document.getElementById("account").innerHTML = '';
			}
		}
		
        $(window).on('tap', '.action-clickview', function() {
          var state = app.getState();
          var _this = $(this).data('view');
          if(_this && _this != '') {
              clicked(_this);
          }
        });

        $('#setting').on('tap', function() {
          var _this = $(this).data('view');
          var faid = plus.webview.currentWebview().id;
          clicked(_this, {
            'faid': faid
          });
        });


        
      });

      $('.bbc-tab-item').on('tap', function() {
        var webview = $(this).data('webview');
        if(webview) {
          mui.openWindow({
            url: webview,
            id: webview,
            createNew: false, //是否重复创建同样id的webview，默认为false:不重复创建，直接显示
            show: {
              autoShow: true, //页面loaded事件发生后自动显示，默认为true
              aniShow: 'none'
            },
            waiting: {
              autoShow: true //自动显示等待框，默认为true
            }
          });
          var openw = plus.webview.getWebviewById(webview);
          if(openw) {
            mui.fire(openw, 'refresh');
          }
        }
      });
      function defaultImg() {
        if(ret.avar){
            document.getElementById("head-img").src = config.imgser+'/'+ret.avar;
        }else{
            document.getElementById("head-img").src = '../../shop_logo.gif';
        }
            
      }
    </script>
  </body>

</html>
